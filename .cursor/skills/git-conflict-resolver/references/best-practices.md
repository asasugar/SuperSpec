# Git冲突解决最佳实践

## 冲突类型

### 1. 内容冲突 (Content Conflict)
最常见的冲突类型，两个分支修改了同一文件的同一区域。

**特征:**
```
<<<<<<< HEAD
当前分支的代码
=======
目标分支的代码
>>>>>>> branch-name
```

**解决策略:**
- 仔细审查两边的更改
- 保留双方有价值的更改
- 确保合并后的代码逻辑正确

### 2. 删除冲突 (Delete Conflict)
一个分支删除了文件，另一个分支修改了文件。

**解决策略:**
- 如果删除是有意的，使用 `git rm <file>`
- 如果需要保留修改，使用 `git add <file>`

### 3. 重命名冲突 (Rename Conflict)
两个分支重命名了同一个文件到不同的名称。

**解决策略:**
- 选择一个合适的文件名
- 使用 `git mv` 重命名
- 确保所有引用都已更新

## 解决策略

### Ours (保留当前分支)
适用场景:
- 当前分支的更改是正确的
- 目标分支的更改不需要
- 功能分支合并到主分支时，通常保留功能分支的更改

```bash
git checkout --ours <file>
git add <file>
```

### Theirs (保留目标分支)
适用场景:
- 目标分支的更改是正确的
- 当前分支的更改已过时
- 从主分支更新功能分支时，通常保留主分支的更改

```bash
git checkout --theirs <file>
git add <file>
```

### Manual (手动合并)
适用场景:
- 双方都有有价值的更改
- 需要合并双方的逻辑
- 复杂的业务逻辑冲突

**步骤:**
1. 打开冲突文件
2. 找到冲突标记
3. 仔细审查两边的代码
4. 手动合并或重写
5. 删除冲突标记
6. `git add <file>`

### Merge (智能合并)
适用场景:
- 双方修改了不同的部分
- 可以自动合并
- 简单的添加/删除操作

## 工作流程

### 1. 检测冲突
```bash
git status
git diff --check
```

### 2. 分析冲突
- 查看冲突文件列表
- 分析每个冲突的类型和影响范围
- 确定解决策略

### 3. 解决冲突
- 根据策略解决每个冲突文件
- 确保代码逻辑正确
- 保持代码风格一致

### 4. 验证解决
```bash
git status
git diff --check
# 运行测试
# 编译检查
```

### 5. 完成合并
```bash
git add <resolved-files>
git commit
```

## 常见问题

### 冲突文件太多怎么办？
1. 按文件类型分组处理
2. 先处理简单的冲突（ours/theirs）
3. 再处理复杂的冲突（manual）
4. 使用脚本批量处理相似冲突

### 如何避免冲突？
1. 频繁同步主分支
2. 小粒度提交
3. 团队成员沟通
4. 使用功能分支
5. 代码审查

### 解决冲突后如何验证？
1. 运行测试套件
2. 检查编译错误
3. 代码审查
4. 功能验证

## 工具和脚本

### 使用冲突检测脚本
```bash
python scripts/detect_conflicts.py
```

### 使用冲突分析脚本
```bash
python scripts/analyze_conflict.py <file>
```

### 使用冲突解决脚本
```bash
python scripts/resolve_conflict.py <file> <strategy>
```

## 注意事项

1. **不要盲目接受所有更改** - 仔细审查每个冲突
2. **保持代码质量** - 解决冲突后确保代码仍然符合规范
3. **运行测试** - 解决冲突后必须运行测试
4. **提交信息** - 在提交信息中说明冲突解决策略
5. **备份** - 复杂冲突解决前先备份
